library(stats)
library(igraph)
library( network )
library( sna )

file_names<- list.files("D:/付琳/毛坦厂/R纵向分析/网络描述")
for (i in 1:length(file_names)) {
  #读入网络矩阵
  name<-gsub(".txt","",file_names[i])
  assign(name,as.matrix(read.table(file_names[i],sep = " ",header = FALSE)))
  
}

# Define the function
Chisq_dep <- function(var1,var2){
  # a and b should be 0-1 arrays
  tab <- table(var1,var2)
  A <- tab["0","1"]
  D <- tab["1","0"]
  (A-D)*(A-D)/(A+D)
}
Chisq_dep(理03T1friend,理03T2friend)
Chisq_dep(理03T2friend,理03T3friend)
Chisq_dep(理03T3friend,理03T4friend)
Chisq_dep(理04T1friend,理04T2friend)
Chisq_dep(理04T2friend,理04T3friend)
Chisq_dep(理04T3friend,理04T4friend)
Chisq_dep(理11T1friend,理11T2friend)
Chisq_dep(理11T2friend,理11T3friend)
Chisq_dep(理11T3friend,理11T4friend)
Chisq_dep(理27T1friend,理27T2friend)
Chisq_dep(理27T2friend,理27T3friend)
Chisq_dep(理27T3friend,理27T4friend)
Chisq_dep(理35T1friend,理35T2friend)
Chisq_dep(理35T2friend,理35T3friend)
Chisq_dep(理35T3friend,理35T4friend)
Chisq_dep(文06T1friend,文06T2friend)
Chisq_dep(文06T2friend,文06T3friend)
Chisq_dep(文06T3friend,文06T4friend)
Chisq_dep(文07T1friend,文07T2friend)
Chisq_dep(文07T2friend,文07T3friend)
Chisq_dep(文07T3friend,文07T4friend)
Chisq_dep(文08T1friend,文08T2friend)
Chisq_dep(文08T2friend,文08T3friend)
Chisq_dep(文08T3friend,文08T4friend)
Chisq_dep(文17T1friend,文17T2friend)
Chisq_dep(文17T2friend,文17T3friend)
Chisq_dep(文17T3friend,文17T4friend)


S03T1net <- as.network(理03T1friend)
S04T1net <- as.network(理04T1friend)
S11T1net <- as.network(理11T1friend)
S27T1net <- as.network(理27T1friend)
S35T1net <- as.network(理35T1friend)
A06T1net <- as.network(文06T1friend)
A07T1net <- as.network(文07T1friend)
A08T1net <- as.network(文08T1friend)
A17T1net <- as.network(文17T1friend)
S03T2net <- as.network(理03T2friend)
S04T2net <- as.network(理04T2friend)
S11T2net <- as.network(理11T2friend)
S27T2net <- as.network(理27T2friend)
S35T2net <- as.network(理35T2friend)
A06T2net <- as.network(文06T2friend)
A07T2net <- as.network(文07T2friend)
A08T2net <- as.network(文08T2friend)
A17T2net <- as.network(文17T2friend)
S03T3net <- as.network(理03T3friend)
S04T3net <- as.network(理04T3friend)
S11T3net <- as.network(理11T3friend)
S27T3net <- as.network(理27T3friend)
S35T3net <- as.network(理35T3friend)
A06T3net <- as.network(文06T3friend)
A07T3net <- as.network(文07T3friend)
A08T3net <- as.network(文08T3friend)
A17T3net <- as.network(文17T3friend)
S03T4net <- as.network(理03T4friend)
S04T4net <- as.network(理04T4friend)
S11T4net <- as.network(理11T4friend)
S27T4net <- as.network(理27T4friend)
S35T4net <- as.network(理35T4friend)
A06T4net <- as.network(文06T4friend)
A07T4net <- as.network(文07T4friend)
A08T4net <- as.network(文08T4friend)
A17T4net <- as.network(文17T4friend)

plot(S03T1net)
plot(S04T1net)
plot(S11T1net)
plot(S27T1net)
plot(S35T1net)
plot(A06T1net)
plot(A07T1net)
plot(A08T1net)
plot(A17T1net)
plot(S03T2net)
plot(S04T2net)
plot(S11T2net)
plot(S27T2net)
plot(S35T2net)
plot(A06T2net)
plot(A07T2net)
plot(A08T2net)
plot(A17T2net)
plot(S03T3net)
plot(S04T3net)
plot(S11T3net)
plot(S27T3net)
plot(S35T3net)
plot(A06T3net)
plot(A07T3net)
plot(A08T3net)
plot(A17T3net)
plot(S03T4net)
plot(S04T4net)
plot(S11T4net)
plot(S27T4net)
plot(S35T4net)
plot(A06T4net)
plot(A07T4net)
plot(A08T4net)
plot(A17T4net)

# Define the function
Chisq_RC <- function(var1,var2){
  tab<-matrix(0,2,3)
  tab[1,] <- dyad.census(var1)
  tab[2,] <- dyad.census(var2)
  N <- sum(tab)
  R1 <- sum(tab[1,])
  R2 <- sum(tab[2,])
  C1 <- sum(tab[,1])
  C2 <- sum(tab[,2])
  C3 <- sum(tab[,3])
  N*(tab[1,1]*tab[1,1]/R1/C1+tab[1,2]*tab[1,2]/R1/C2+tab[1,3]*tab[1,3]/R1/C3+
       tab[2,1]*tab[2,1]/R2/C1+tab[2,2]*tab[2,2]/R2/C2+tab[2,3]*tab[2,3]/R2/C3-1)
}

Chisq_RC(S03T1net,S03T2net)
Chisq_RC(S03T2net,S03T3net)
Chisq_RC(S03T3net,S03T4net)
Chisq_RC(S04T1net,S04T2net)
Chisq_RC(S04T2net,S04T3net)
Chisq_RC(S04T3net,S04T4net)
Chisq_RC(S11T1net,S11T2net)
Chisq_RC(S11T2net,S11T3net)
Chisq_RC(S11T3net,S11T4net)
Chisq_RC(S27T1net,S27T2net)
Chisq_RC(S27T2net,S27T3net)
Chisq_RC(S27T3net,S27T4net)
Chisq_RC(S35T1net,S35T2net)
Chisq_RC(S35T2net,S35T3net)
Chisq_RC(S35T3net,S35T4net)
Chisq_RC(A06T1net,A06T2net)
Chisq_RC(A06T2net,A06T3net)
Chisq_RC(A06T3net,A06T4net)
Chisq_RC(A07T1net,A07T2net)
Chisq_RC(A07T2net,A07T3net)
Chisq_RC(A07T3net,A07T4net)
Chisq_RC(A08T1net,A08T2net)
Chisq_RC(A08T2net,A08T3net)
Chisq_RC(A08T3net,A08T4net)
Chisq_RC(A17T1net,A17T2net)
Chisq_RC(A17T2net,A17T3net)
Chisq_RC(A17T3net,A17T4net)
